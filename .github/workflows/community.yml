name: ğŸ¯ Community Contribution Tracking

on:
  issues:
    types: [opened, closed, labeled]
  pull_request_target:
    types: [opened, closed, reopened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'opened'
    permissions:
      issues: write
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          script: |
            const isFirstIssue = (
              await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                creator: context.payload.issue.user.login,
                state: 'all'
              })
            ).data.length === 1;
            
            if (isFirstIssue) {
              const message = [
                'ğŸ‘‹ Welcome to AI Code Reviewer! Thanks for opening your first issue.',
                '',
                'We appreciate your contribution to making this project better. A maintainer will review your issue soon.',
                '',
                'In the meantime:',
                '- â­ Star the repo if you find it useful',
                '- ğŸ“– Check out our [Contributing Guide](CONTRIBUTING.md)',
                `- ğŸ’¬ Join discussions in [GitHub Discussions](https://github.com/${context.repo.owner}/${context.repo.repo}/discussions)`,
                '',
                'Happy coding! ğŸš€'
              ].join('\n');
              
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: message
              });
            }

  welcome-pr:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target' && github.event.action == 'opened'
    permissions:
      pull-requests: write
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          script: |
            const isFirstPR = (
              await github.rest.pulls.list({
                owner: context.repo.owner,
                repo: context.repo.repo,
                creator: context.payload.pull_request.user.login,
                state: 'all'
              })
            ).data.length === 1;
            
            if (isFirstPR) {
              const message = [
                'ğŸ‰ Thanks for opening your first pull request!',
                '',
                'We\'re excited to review your contribution. A maintainer will take a look soon.',
                '',
                '**Helpful tips:**',
                '- âœ… Make sure all tests pass',
                '- ğŸ“ Update documentation if needed',
                '- ğŸ” Review our [Contributing Guide](CONTRIBUTING.md)',
                '',
                'We appreciate your contribution to AI Code Reviewer! ğŸ™Œ'
              ].join('\n');
              
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: message
              });
            }
