# Example: AI Code Review with OpenAI/ChatGPT
#
# This workflow demonstrates how to set up automated AI code reviews using OpenAI's ChatGPT models.
# It runs on every pull request and provides detailed code review with inline comments.
#
# Prerequisites:
# 1. Add your OpenAI API key as a repository secret named CHATGPT_API_KEY or OPENAI_API_KEY
#    - Get your API key from: https://platform.openai.com/api-keys
# 2. Ensure the workflow has proper permissions (see below)
#
# Supported Models:
# - gpt-5-mini (recommended, cost-effective)
# - gpt-4o (advanced reasoning)
# - gpt-4-turbo (powerful, higher cost)
# - o1, o3 (reasoning models)

name: AI Review (OpenAI)

on:
  pull_request:
    types: [opened, reopened, synchronize]

# Workflow-level concurrency: cancel in-progress runs when new commits are pushed
concurrency:
  group: ai-review-openai-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  contents: read        # Read repository contents
  pull-requests: write  # Post comments and reviews on PRs

jobs:
  ai-review:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: AI Code Review with OpenAI
        uses: ashsaym/ai-code-reviewer/next-gen-ai-reviewer@v1.0.0
        with:
          # Required: Pull request number
          pr-number: ${{ github.event.pull_request.number }}
          
          # Provider configuration
          ai-provider: chatgpt
          chatgpt-model: gpt-5-mini
          
          # Task type: review, summary, suggestions, or description
          # - review: Detailed code review with inline comments (default)
          # - summary: Executive summary of changes
          # - suggestions: Actionable improvement suggestions
          # - description: Auto-generate/update PR description
          task: review
          
          # Control what gets analyzed
          max-files: 60              # Maximum number of files to review
          max-diff-chars: 18000      # Max diff characters per file
          max-output-tokens: 16000   # Max tokens in AI response
          
          # ChatGPT-specific settings
          # - auto: Automatically detect which parameter to use based on model
          # - true: Use max_completion_tokens (for gpt-4o, gpt-5-mini, o1, o3)
          # - false: Use max_tokens (for gpt-4-turbo, gpt-3.5-turbo, older models)
          max-completion-tokens-mode: auto
          
          # Enable inline review comments on specific lines
          inline-review: "true"
          
          # Custom name for the AI reviewer in comments
          reviewer-name: "AI Code Reviewer Bot"
          
          # Optional: Add custom instructions for the AI
          # additional-context: |
          #   Focus on:
          #   - Security vulnerabilities
          #   - Performance issues
          #   - Best practices violations
          #   - Proper error handling
        
        env:
          # Required: GitHub token (automatically provided)
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          # Required: OpenAI API key
          # You can use either CHATGPT_API_KEY or OPENAI_API_KEY
          CHATGPT_API_KEY: ${{ secrets.CHATGPT_API_KEY }}
          # OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# Configuration Tips:
# 
# 1. Model Selection:
#    - For cost-effective reviews: gpt-5-mini
#    - For complex codebases: gpt-4o or gpt-4-turbo
#    - For reasoning-heavy analysis: o1 or o3
#
# 2. Token Limits:
#    - gpt-5-mini: up to 128K context, set max-output-tokens to 16000-32000
#    - gpt-4o: up to 128K context, set max-output-tokens to 16000-32000
#    - o1/o3: Different pricing model, adjust accordingly
#
# 3. Inline Comments:
#    - Set inline-review: "true" to get GitHub-style inline comments
#    - Set inline-review: "false" for single summary comment
#
# 4. Custom Instructions:
#    - Use additional-context to add repository-specific guidance
#    - Or add .github/review-instructions.md file to your repo
#
# 5. Multiple Tasks:
#    - Run different tasks in parallel using matrix strategy:
#      strategy:
#        matrix:
#          task: [review, summary, suggestions]
#    - Then use: task: ${{ matrix.task }}
#
# 6. Repository Guidance Files:
#    The action automatically loads these files if present:
#    - .github/review-instructions.md - Team review guidelines
#    - .github/review-rulesets.md - Compliance rules
#    - .github/review-ignorelist.txt - Patterns to exclude
#    - .github/prompts/review.md - Custom prompt template
#
# Troubleshooting:
# - If you get API errors, check your API key is valid
# - If reviews are incomplete, increase max-output-tokens
# - If too many files, decrease max-files or use review-ignorelist.txt
# - For rate limits, add a delay or reduce frequency
